# 编译配置

编译配置（也称为编译目标）是一组项目设置，决定了集成开发环境将如何编译项目。编译配置通常包括以下内容：可执行文件的名称、集成开发环境将在哪些目录中查找其他代码和库文件、是保留还是删除调试信息、编译器将在多大程度上优化程序等......一般来说，除非有特殊原因需要更改，否则这些设置应保持默认值。

在集成开发环境中创建新项目时，大多数集成开发环境都会为您设置两种不同的构建配置：release配置和 debug配置。

debug configuration 旨在帮助您调试程序，通常是您在编写程序时使用的配置。该配置关闭了所有优化功能，并包含调试信息，因此程序会变大、变慢，但调试起来却容易得多。默认情况下，调试配置通常被选为活动配置。我们将在后面的课程中详细介绍调试技术。

release configuration 用于向公众发布程序。该版本通常对大小和性能进行了优化，不包含额外的调试信息。由于发行版配置包含了所有优化，因此该模式在测试代码性能时也非常有用（我们将在本教程系列的稍后部分向您演示如何进行测试）。

使用 Visual Studio 编译 Hello World 程序时，debug配置生成的可执行文件为 65KB，而发布版本生成的可执行文件只有 12KB。造成这种差异的主要原因是调试构建时保留了额外的调试信息。

> [!NOTE]
>
> 开发程序时，请使用调试构建配置。 当您准备向他人发布可执行文件或想测试性能时，请使用发布构建配置。

有些集成开发环境（如 Visual Studio）还会为不同平台创建单独的构建配置。例如，Visual Studio 会为 x86（32 位）和 x64（64 位）平台创建构建配置。对于使用G++/GCC的开发者而言，调试时在命令行中添加 `-ggdb`，发布版本时添加 `-O2 -DNDEBUG`。 目前使用前者。




# 编译器扩展

C++ 标准定义了程序在特定情况下的行为规则。在大多数情况下，编译器会遵循这些规则。然而，许多编译器会对语言进行自己的修改，通常是为了增强与其他语言版本（如 C99）的兼容性，或出于历史原因。这些特定于编译器的行为被称为编译器扩展。

使用编译器扩展编写的程序，允许编写与 C++ 标准不兼容的程序。使用非标准扩展的程序通常无法在其他编译器（不支持相同扩展的编译器）上编译，即使能编译，也可能无法正确运行。

令人沮丧的是，编译器扩展通常是默认启用的。这对新手来说尤其有害，因为他们可能会认为某些有效的行为是 C++ 官方标准的一部分，而实际上他们的编译器只是过度许可了而已。

**由于编译器扩展并非必要，而且会导致程序不符合 C++ 标准，因此我们建议关闭编译器扩展。**

Visual Studio：右键项目->属性，在面板中首先确保 "Configuration"字段设置为 "All Configuration"。C/C++ -> Language，将 "一致性模式 "设置为 yes。

![[20240724215832.png]]

GCC/G++：可以通过在编译命令行中添加 ` -pedantic-errors ` 标志来禁用编译器扩展。



# 警告与错误等级

当你编写程序时，编译器会检查你是否遵循了 C++ 语言的规则（假设已经关闭编译器扩展）。如果您的操作明确违反了语言规则，编译器需要发出一条诊断信息（diagnostic message）。 C++ 标准并未规定诊断信息应如何分类或措辞。不过，编译器采用了一些常见的约定。

如果由于违反规定而导致编译无法继续，编译器会发出错误提示（error），提供包含错误的行号，以及一些关于预期错误和发现错误的文字。错误会阻止编译继续进行。实际错误可能发生在该行，也可能发生在前一行。一旦找出并修复了错误的代码行，就可以再次尝试编译。

如果编译过程中出现了违规现象，但编译器仍能继续编译，那么编译器可能会发出错误（error）或警告(warning)。警告与错误类似，但不会停止编译。

在某些情况下，编译器可能会识别出不违反语言规则但它认为可能不正确的代码。在这种情况下，编译器可能会发出警告，提醒程序员似乎有问题。

在大多数情况下，要解决警告问题，要么修复警告所指出的问题，要么重写产生警告的代码行，使其不再产生警告。

在极少数情况下，可能需要明确告诉编译器不要对相关代码行生成特定警告。 C++ 不支持这样做的官方方法，但许多编译器（包括 Visual Studio 和 GCC）都提供了暂时禁用警告的解决方案（通过不可移植的 `#pragma` 指令）。



## 提高警告级别

默认情况下，大多数编译器只会对最明显的问题生成警告。不过，您可以要求编译器更主动地对其发现的奇怪问题发出警告。

> [!TIP]
>
> 将警告级别调到最高，尤其是在学习过程中。 它将帮助你发现可能存在的问题。

Visual Studio：

![[20240724221110.png|750]]

Visual Studio 默认禁用已签名/未签名转换（signed/unsigned conversion warnings）警告，这些警告非常有用，因此如果您使用的是 Visual Studio 2019 或更新版本，请启用这些警告：

- C/C++ -> Command Line tab，添加 /w44365。这将告诉编译器启用警告级别为 4 的有符号/无符号转换警告。
- C/C++ -> External Includes tab，将外部头警告级别设置为 Level3 (/external:W3)。这将使编译器以警告级别 3（而不是 4）编译标准库头文件，这样编译这些头文件就不会触发此警告。

![[20240724221713.png|750]]

![[20240724221921.png|750]]

GCC/G++：在命令行中添加以下标记 ` -Wall -Weffc++ -Wextra -Wconversion -Wsign-conversion ` 



## 将警告视为错误



也可以告诉编译器将所有警告当作错误处理（在这种情况下，编译器会在发现任何警告时停止编译）。这也是执行 "您应该修复所有警告 "这一建议的好方法。

Visual Studio：

![[20240724222346.png]]


GCC/G++：在命令行中添加以下标记 ` -Werror `



# 选择语言标准

C++ 有许多不同的版本（C++98、C++03、C++11、C++14、C++17、C++20、C++23 等），编译器如何知道该使用哪个版本？ 一般来说，编译器会选择一个标准作为默认标准。通常情况下，默认的标准并不是最新的语言标准，更多是默认使用 C++14，但它缺少许多最新、最强大的功能。

如果希望使用不同的语言标准，则必须对 IDE 或编译器进行配置。

代码名称对应的语言标准

定稿的语言标准以其定稿年份命名（例如，C++17 于 2017 年定稿）。

然而，在制定新的语言标准时，并不清楚将在哪一年最终确定。因此，即将出台的语言标准会被赋予代码名称（Code names），然后在标准最终确定后由实际名称取代。您可能仍然会在某些地方看到使用的代码名称（特别是对于还没有最终名称的最新进行中的语言标准）。

![[20240724223331.png]]


选择哪种语言标准

在专业版环境中，通常会选择比最新标准晚一到两个版本的语言标准（例如，如果 C++20 是最新版本，那就意味着 C++14 或 C++17）。这样做通常是为了确保编译器制造商有机会解决缺陷，并充分了解新功能的最佳实践。在相关情况下，这也有助于确保更好的跨平台兼容性，因为某些平台上的编译器可能无法立即提供对较新语言标准的全面支持。

本网站目前以 C++17 标准为目标，这意味着我们的课程和示例假定您的编译器支持 C++17。部分 C++20 和 C++23 内容适用于使用兼容编译器的用户。要充分利用所有课程内容，我们建议您使用编译器支持的最新语言标准。如果您的编译器不支持 C++17，我们建议您升级到支持 C++17 的编译器，或者考虑在学习过程中使用支持 C++17 或更新版本的在线编译器。