`schema.` 是可选的可以不用写的，`schema.` 不指明时则默认为 `main.`

# synchronous


```mysql
PRAGMA schema.synchronous;
PRAGMA schema.synchronous = 0 | OFF | 1 | NORMAL | 2 | FULL | 3 | EXTRA;
```

查询或更改 "同步"标志的设置。第一种（查询）形式将以整数形式返回同步设置的结果。第二种形式可以更改同步设置。各种同步设置的含义如下：

**EXTRA (3)**：EXTRA 同步与 FULL 同步类似，但在 DELETE 模式下提交事务时，包含回滚日志的目录会在取消日志链接后同步。EXTRA 可在提交后紧接着断电的情况下提供额外的耐用性。

**FULL (2)**：同步为 FULL 时，SQLite 数据库引擎将使用 VFS 的 xSync 方法，确保在继续之前将所有内容安全写入磁盘表面。这可确保操作系统崩溃或断电不会损坏数据库。完全同步非常安全，但速度也较慢。在不使用 WAL 模式时，FULL 是最常用的同步设置。

**NORMAL (1)**：同步模式为 NORMAL 时，SQLite 数据库引擎仍会在最关键时刻同步，但频率低于 FULL 模式。在较旧的文件系统上，在 journal_mode=DELETE 下，在错误的时间断电可能会损坏数据库，这种可能性非常小（虽然不是零）。在 synchronous=NORMAL的情况下，WAL mode不会损坏数据库，在现代文件系统上，DELETE 模式可能也是安全的。在 synchronous=NORMAL的情况下，WAL 模式始终保持一致，但 WAL 模式会失去持久性。在 synchronous=NORMAL的 WAL 模式下提交的事务可能会在断电或系统崩溃后回滚。无论同步设置或日志模式如何，事务在应用程序崩溃时都是持久的。对于大多数在 WAL 模式下运行的应用程序来说，同步=NORMAL 设置是个不错的选择。

**OFF (0)**：如果同步为 OFF，SQLite 会在将数据移交给操作系统后继续运行而不同步。如果运行 SQLite 的应用程序崩溃，数据将是安全的，但如果在数据写入磁盘表面之前操作系统崩溃或计算机断电，数据库可能会损坏。另一方面，同步关闭的提交速度可以快上几个数量级。

---

这段话解释了 SQLite 数据库引擎在不同同步（synchronous）设置下的行为，特别是当同步设置为 NORMAL（1）时的情况。它描述了不同同步模式对数据库一致性和持久性的影响，特别是针对传统日志模式（journal_mode=DELETE）和 Write-Ahead Logging（WAL）模式。

以下是对关键点的详细解释：

同步设置为 NORMAL（1）：

关键时刻的同步：当同步设置为 NORMAL 时，SQLite 数据库引擎会在最关键的时刻执行同步操作，但频率比 FULL 模式要低。
电源故障风险：在 journal_mode=DELETE 模式下，旧文件系统中存在极小的（但非零）可能性，即在某些特定时刻发生电源故障可能导致数据库损坏。
现代文件系统的安全性：在现代文件系统中，使用 DELETE 模式也很可能是安全的。
WAL 模式下的行为：

一致性：在 WAL 模式下，使用同步=NORMAL 时，数据库始终保持一致性。这意味着，即使在发生异常情况下（如电源故障），数据库文件结构仍然保持一致，不会出现损坏。
持久性降低：虽然 WAL 模式下的一致性得到保障，但持久性可能会受到影响——在同步=NORMAL 时提交的事务，在电源故障或系统崩溃后可能会回滚（即丢失事务）。
应用程序崩溃的稳定性：

事务持久性：无论同步设置为何值，事务在应用程序崩溃时是持久的。这意味着如果只是应用程序崩溃（而非系统崩溃或电源故障），事务数据将不会丢失。
同步=NORMAL 的推荐使用场景：

适用大多数应用：对于在 WAL 模式下运行的应用程序，设置同步=NORMAL 是一种不错的选择，因为它在保证较好性能的同时，也提供了足够的安全性和一致性。
总结来说，当 SQLite 的同步设置为 NORMAL 时：

在 WAL 模式下，数据库文件会保持一致，但在电源故障或系统崩溃时，最近提交的事务可能会丢失。
在 DELETE 模式下，虽然存在极小的数据库损坏风险，但在现代文件系统上通常是安全的。
在应用程序崩溃时，所有同步设置都能保证事务的持久性。
这种设置在性能和数据安全之间取得了一个平衡，适合大多数使用 WAL 模式的应用程序。


在数据库中，“回滚”是指撤销或取消已经执行的事务操作，使数据库恢复到之前的状态。在电源故障或系统崩溃导致数据库操作中断时，可能会发生事务的丢失或回滚。

具体来说，当一个事务尚未完成（例如，某些数据已经被修改但尚未写入磁盘），突然发生了电源故障或系统崩溃，这时候数据库引擎可能无法保证所有的事务都能够完全提交。在这种情况下，数据库可能需要回滚部分或全部未完成的事务，以确保数据库恢复到一致的状态。

简而言之，回滚意味着数据库引擎会撤销在事务提交之前所做的更改，以确保数据库不会保持在一个不一致的状态。这样做是为了维护数据库的一致性和完整性。

滚的具体范围取决于数据库管理系统的实现和配置。一般来说，当发生电源故障或系统崩溃时，数据库管理系统会尝试将所有未提交的事务回滚，以确保数据库的一致性和完整性。

具体来说：

未提交的事务：如果一个事务正在进行中或者某些修改已经被应用到数据库但尚未提交，这些修改可能会被回滚。
已提交的事务：通常情况下，已经成功提交的事务一般不会被回滚。只有那些未完成或未提交的事务才会被撤销。
数据库管理系统会记录已提交的事务，以便在恢复后能够保留这些变更。然而，未提交的事务可能因为系统崩溃而需要回滚，以确保数据的一致性和可靠性。

总之，数据库系统在处理电源故障或系统崩溃时，会尽力回滚未提交的事务，以尽可能地保证数据库的完整性和可靠性。